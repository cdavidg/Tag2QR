{% extends "admin_app/base.html" %}

{% block title %}Dashboard - Super Admin{% endblock %}
{% block page_icon %}fas fa-chart-line{% endblock %}
{% block page_title %}Dashboard General{% endblock %}

{% block content %}
<div class="dashboard-widgets">
    <div class="widget">
        <div class="widget-label"><i class="fas fa-users"></i> Total Usuarios</div>
        <div class="widget-value">{{ total_users }}</div>
        <small style="color: #ffffff;">+{{ recent_users }} últimos 30 días</small>
    </div>
    
    <div class="widget">
        <div class="widget-label"><i class="fas fa-box"></i> Total Productos</div>
        <div class="widget-value">{{ total_products }}</div>
        <small style="color: #ffffff;">+{{ recent_products }} últimos 30 días</small>
    </div>
    
    <div class="widget">
        <div class="widget-label"><i class="fas fa-user-check"></i> Usuarios Activos</div>
        <div class="widget-value">{{ active_users }}</div>
        <small style="color: #999999;">Con productos creados</small>
    </div>
    
    <div class="widget">
        <div class="widget-label"><i class="fas fa-store"></i> Tiendas Configuradas</div>
        <div class="widget-value">{{ total_stores }}</div>
        <small style="color: #999999;">Total de {{ total_users }} usuarios</small>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
    <!-- Usuarios más activos -->
    <div class="card">
        <div class="card-header">
            <i class="fas fa-trophy"></i> Usuarios Más Activos
        </div>
        <div class="card-body">
            {% if top_users %}
                <table class="wp-list-table">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Productos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user, count in top_users %}
                        <tr>
                            <td>
                                <a href="{{ url_for('admin_app.user_detail', user_id=user.id) }}">
                                    <i class="fas fa-user"></i> {{ user.email }}
                                </a>
                            </td>
                            <td><strong>{{ count }}</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color: #999999; text-align: center; padding: 20px;">No hay datos disponibles</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Productos más visitados -->
    <div class="card">
        <div class="card-header">
            <i class="fas fa-eye"></i> Productos Más Visitados (30 días)
        </div>
        <div class="card-body">
            {% if top_products %}
                <table class="wp-list-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Visitas</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product, views in top_products %}
                        <tr>
                            <td>
                                <strong>{{ product.name }}</strong><br>
                                <small style="color: #999999;">{{ product.creator.email }}</small>
                            </td>
                            <td><strong>{{ views }}</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color: #999999; text-align: center; padding: 20px;">No hay datos disponibles</p>
            {% endif %}
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <!-- Últimos usuarios registrados -->
    <div class="card">
        <div class="card-header">
            <i class="fas fa-user-plus"></i> Últimos Usuarios Registrados
        </div>
        <div class="card-body">
            {% if latest_users %}
                <table class="wp-list-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Registro</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in latest_users %}
                        <tr>
                            <td>
                                <a href="{{ url_for('admin_app.user_detail', user_id=user.id) }}">
                                    {{ user.email }}
                                </a>
                                {% if user.is_superadmin %}
                                    <span class="badge badge-danger"><i class="fas fa-crown"></i> Super Admin</span>
                                {% elif user.is_admin %}
                                    <span class="badge badge-info"><i class="fas fa-user-shield"></i> Admin</span>
                                {% endif %}
                            </td>
                            <td>{{ user.created_at.strftime('%d/%m/%Y') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color: #999999; text-align: center; padding: 20px;">No hay usuarios registrados</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Últimos productos creados -->
    <div class="card">
        <div class="card-header">
            <i class="fas fa-box-open"></i> Últimos Productos Creados
        </div>
        <div class="card-body">
            {% if latest_products %}
                <table class="wp-list-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Creado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in latest_products %}
                        <tr>
                            <td>
                                <strong>{{ product.name }}</strong><br>
                                <small style="color: #999999;">{{ product.creator.email }}</small>
                            </td>
                            <td>{{ product.created_at.strftime('%d/%m/%Y') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color: #999999; text-align: center; padding: 20px;">No hay productos creados</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
