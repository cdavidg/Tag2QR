{% extends "admin_app/base.html" %}

{% block title %}Usuarios - Super Admin{% endblock %}
{% block page_icon %}fas fa-users{% endblock %}
{% block page_title %}Gestión de Usuarios{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <span><i class="fas fa-list"></i> Lista de Usuarios</span>
    </div>
    
    <div class="card-body">
        <!-- Filtros y búsqueda -->
        <form method="get" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
            <input type="text" 
                   name="search" 
                   class="form-control" 
                   placeholder="Buscar por email..." 
                   value="{{ search }}"
                   style="max-width: 300px;">
            
            <select name="filter" class="form-control" style="max-width: 200px;">
                <option value="all" {% if filter_type == 'all' %}selected{% endif %}>Todos</option>
                <option value="superadmin" {% if filter_type == 'superadmin' %}selected{% endif %}>Superadministradores</option>
                <option value="admin" {% if filter_type == 'admin' %}selected{% endif %}>Administradores</option>
                <option value="active" {% if filter_type == 'active' %}selected{% endif %}>Con productos</option>
                <option value="inactive" {% if filter_type == 'inactive' %}selected{% endif %}>Sin productos</option>
            </select>
            
            <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> Filtrar</button>
            {% if search or filter_type != 'all' %}
                <a href="{{ url_for('admin_app.user_list') }}" class="btn btn-secondary"><i class="fas fa-times"></i> Limpiar</a>
            {% endif %}
        </form>
        
        <!-- Tabla de usuarios -->
        {% if users.items %}
            <table class="wp-list-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Productos</th>
                        <th>Categorías</th>
                        <th>Tienda</th>
                        <th>Registro</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users.items %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>
                            <strong>{{ user.email }}</strong>
                        </td>
                        <td>
                            {% if user.is_superadmin %}
                                <span class="badge badge-danger"><i class="fas fa-crown"></i> Super Admin</span>
                            {% elif user.is_admin %}
                                <span class="badge badge-info"><i class="fas fa-user-shield"></i> Admin</span>
                            {% else %}
                                <span class="badge" style="background: #666666; color: #ffffff;">Usuario</span>
                            {% endif %}
                        </td>
                        <td>{{ user.product_count }}</td>
                        <td>{{ user.category_count }}</td>
                        <td>
                            {% if user.has_store %}
                                <span class="badge badge-success"><i class="fas fa-check"></i></span>
                            {% else %}
                                <span class="badge" style="background: #666666; color: #ffffff;"><i class="fas fa-times"></i></span>
                            {% endif %}
                        </td>
                        <td>{{ user.created_at.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <a href="{{ url_for('admin_app.user_detail', user_id=user.id) }}" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">
                                <i class="fas fa-eye"></i> Ver
                            </a>
                            <a href="{{ url_for('admin_app.user_edit', user_id=user.id) }}" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                <i class="fas fa-edit"></i> Editar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Paginación -->
            {% if users.pages > 1 %}
                <div class="pagination">
                    {% if users.has_prev %}
                        <a href="{{ url_for('admin_app.user_list', page=users.prev_num, search=search, filter=filter_type) }}">« Anterior</a>
                    {% endif %}
                    
                    {% for page_num in users.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                        {% if page_num %}
                            {% if page_num == users.page %}
                                <span class="active">{{ page_num }}</span>
                            {% else %}
                                <a href="{{ url_for('admin_app.user_list', page=page_num, search=search, filter=filter_type) }}">{{ page_num }}</a>
                            {% endif %}
                        {% else %}
                            <span>...</span>
                        {% endif %}
                    {% endfor %}
                    
                    {% if users.has_next %}
                        <a href="{{ url_for('admin_app.user_list', page=users.next_num, search=search, filter=filter_type) }}">Siguiente »</a>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            <p style="text-align: center; padding: 40px; color: #646970;">
                No se encontraron usuarios con los filtros seleccionados.
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}
